First stage was to find the location of the return address. Second stage was to find the start location of the buffer. Found out the delta was 1040 bytes. So I created nop slide of 16 bytes at the begining of the buffer, then comes the shellcode following nop slides untill byte 1040 which then comes the return address to my shellcode.
My shellcode is straightforward, create a socket, connect it with our c&c server, duplicate stdin, stdout, stderr to the socket, execute a shell. In order to create the connection I wrote a C file which mimicked the initialization of the connection. In order to solve functions overiding the shellcode I moved esp 0x128 places to fix the overide.